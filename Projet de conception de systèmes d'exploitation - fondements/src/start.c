#include "cpu.h"
#include "inttypes.h"
#include "affichage.h"
#include "temps.h"
#include "string.h"
#include "stdio.h"
#include "start.h"
#include "processus.h"

// on peut s'entrainer a utiliser GDB avec ce code de base
// par exemple afficher les valeurs de x, n et res avec la commande display
uint32_t clock_time=0;
// struct processus procs[2];

// une fonction bien connue
// uint32_t fact(uint32_t n)
// {
//     uint32_t res;
//     if (n <= 1) {
//         res = 1;
//     } else {
//         res = fact(n - 1) * n;
//     }
//     return res;
// }
int pid;
extern void traitant_IT_32(void);

void kernel_start(void)
{
    // // uint16_t *x = ptr_mem(1,4);
    efface_ecran(0, 25, 80);
    // ecrit_car(24, 79, 'A', 1, 15, 0);
    // place_curseur(24,79);
    // traite_car('C');
    //
    // //
    // char *c = "\nPlease notice that the practice labs (except the last week assignment) are optional and are provided for you to practice and understand the topic. Therefore, you do not need to submit those, as they are not graded, and won't be updated as complete. Just run the codes to see the results, and feel free to change it.\n";
    // console_putbytes(c,strlen(c));
    //
    affichage_horloge("88:30:06");
    // printf("%s", c);
    // initialisations
    initialiser();
    pid = cree_processus(proc1, "proc1");
    printf("%i", pid);
    // pid = cree_processus(proc1, "proc1");
    // printf("%i", pid);
    pid = cree_processus(proc2, "proc2");
    printf("%i", pid);
    pid = cree_processus(proc3, "proc3");
    pid = cree_processus(proc4, "proc4");
    // printf("%i", pid);
    pid = cree_processus(proc6, "proc6");
    // affichage();

	  init_traitant_IT(32, traitant_IT_32);
    masque_IRQ(0, false);
    regler_horloge();

    // dÃ©masquage des interruptions externes
    // sti();

    // creer_processus();
    idle();
    // quand on saura gerer l'ecran, on pourra afficher x

    // on ne doit jamais sortir de kernel_start
    while (1) {

        // cette fonction arrete le processeur
        hlt();
    }

}
